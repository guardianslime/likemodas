# nixpacks.toml
# Configuración definitiva para construir y ejecutar el backend en Railway

providers = ['python']

[variables]
  NEXT_TELEMETRY_DISABLED = '1'
  NPM_CONFIG_UPDATE_NOTIFIER = 'false'
  NPM_CONFIG_FUND = 'false'
  PIP_DISABLE_PIP_VERSION_CHECK = '1'

[phases.setup]
  apt_packages = ["git", "nodejs", "npm", "unzip", "parallel", "build-essential"]

# --- INICIO DE LA CORRECCIÓN DEFINITIVA ---
# Combinamos dos comandos:
# 1. `alembic upgrade head`: Aplica las migraciones a la base de datos de producción.
# 2. `reflex run ...`: Inicia la aplicación.
# El `&&` se asegura de que el segundo comando solo se ejecute si el primero fue exitoso.
[start]
  cmd = "alembic upgrade head && reflex run --backend-only --host 0.0.0.0 --port 8000 --loglevel info"
# --- FIN DE LA CORRECCIÓN DEFINITIVA ---