# nixpacks.toml

[phases.setup]
# 1. Usamos 'python311Full' que YA INCLUYE PIP (esto arregla el error "No module named pip").
# 2. Agregamos 'nodejs' explícitamente porque Reflex lo necesita para compilar el frontend.
# 3. Agregamos 'unzip' que a veces Reflex requiere.
nixPkgs = [
    "python311Full",
    "nodejs",
    "ffmpeg",
    "zlib",
    "unzip"
]

# Librerías de sistema Linux requeridas para OpenCV (arregla el error libGL)
aptPkgs = [
    "libgl1", 
    "libglib2.0-0", 
    "libsm6", 
    "libxext6", 
    "libxrender1"
]

[phases.install]
# Instalamos las dependencias de Python usando el pip que viene con python311Full
cmds = ["python -m pip install -r requirements.txt"]

[start]
# Arrancamos usando 'python -m reflex' para asegurar que encuentre el módulo
# NOTA: Cambia a 'reflex run --env prod' si prefieres que se encargue él
cmd = "python -m reflex run --env prod --backend-only"

[variables]
# Optimizaciones
OPENCV_VIDEOIO_PRIORITY_MSMF = "0"
PYTHONUNBUFFERED = "1"
# Asegúrate de que este puerto coincida con el que configuraste en Coolify (Backend suele ser 8000)
PORT = "8000"